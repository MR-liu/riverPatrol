# 极光推送测试指南

## ✅ 配置完成状态

恭喜！极光推送已成功配置：

- ✅ AppKey已配置: `463f52032571434a7a2ddeee`
- ✅ npm依赖已安装
- ✅ Android原生配置完成
- ✅ iOS原生配置完成
- ✅ 代码集成完成

## 测试步骤

### 1. 启动应用

#### Android测试
```bash
# 清理并重建
cd android
./gradlew clean
cd ..

# 启动应用
npx expo run:android
```

#### iOS测试
```bash
# 安装Pod依赖
cd ios
pod install
cd ..

# 启动应用
npx expo run:ios
```

### 2. 验证初始化

应用启动后，查看控制台日志：

```
[JPush] 开始初始化...
[JPush] 初始化成功
[JPush] 获取到RegistrationID: xxxxxxxxxxxxxxxxxxxxx
[JPush] 设备注册成功
```

**重要**: 记录下RegistrationID，后续测试需要用到

### 3. 测试推送接收

#### 方法1：通过极光控制台测试

1. 访问 [极光推送控制台](https://www.jiguang.cn/accounts/login)
2. 登录账号
3. 选择应用（AppKey: 463f52032571434a7a2ddeee）
4. 点击"推送" -> "发送通知"
5. 目标选择：
   - 选择"Registration ID"
   - 输入从控制台获取的RegistrationID
6. 通知内容：
   - 标题：测试推送
   - 内容：这是一条测试消息
7. 点击"立即发送"

#### 方法2：通过APP内测试

1. 登录应用
2. 进入"我的" -> "推送设置"
3. 点击"测试推送"按钮
4. 查看是否收到通知

#### 方法3：通过API测试

```bash
# 使用curl测试（需要在后端服务器执行）
curl -X POST https://api.jpush.cn/v3/push \
  -H "Authorization: Basic $(echo -n '463f52032571434a7a2ddeee:dae68cd8344bdd329d032915' | base64)" \
  -H "Content-Type: application/json" \
  -d '{
    "platform": "all",
    "audience": {
      "registration_id": ["你的RegistrationID"]
    },
    "notification": {
      "alert": "测试推送消息",
      "android": {
        "title": "测试标题"
      },
      "ios": {
        "alert": "测试推送消息",
        "sound": "default"
      }
    }
  }'
```

### 4. 验证推送功能

#### 检查项清单

- [ ] 应用启动时能获取到RegistrationID
- [ ] 能收到测试推送通知
- [ ] 点击通知能打开应用
- [ ] 推送设置页面功能正常
- [ ] 能正确显示推送内容

#### 日志查看

**Android日志**：
```bash
# 查看所有JPush相关日志
adb logcat | grep -i jpush

# 查看应用日志
adb logcat | grep com.riverpatrol.app
```

**iOS日志**：
在Xcode控制台查看日志输出

### 5. 常见问题排查

#### 问题1：获取不到RegistrationID

**可能原因**：
- 网络连接问题
- AppKey配置错误
- 极光服务器连接失败

**解决方案**：
1. 检查网络连接
2. 确认AppKey正确：`463f52032571434a7a2ddeee`
3. 查看详细日志

#### 问题2：收不到推送

**Android检查**：
1. 检查通知权限是否开启
2. 检查应用是否被系统杀死
3. 部分手机需要允许自启动权限

**iOS检查**：
1. 必须在真机测试（模拟器不支持）
2. 检查推送证书配置
3. 检查通知权限

#### 问题3：点击通知无响应

检查`JPushService.ts`中的`handleNotificationOpen`方法是否正确实现

### 6. 生产环境配置

在发布前需要：

1. **修改production标志**：
   编辑`.env.local`：
   ```
   EXPO_PUBLIC_JPUSH_PRODUCTION=true
   ```

2. **iOS推送证书**：
   - 生成生产环境的推送证书
   - 在极光控制台上传证书

3. **Android配置**：
   - 确保签名配置正确
   - 混淆配置中保留极光推送类

### 7. 推送数据格式

标准推送数据格式：

```json
{
  "title": "工单通知",
  "content": "您有新的工单需要处理",
  "extras": {
    "type": "workorder",
    "target_id": "WO_20240101_0001",
    "priority": "urgent"
  }
}
```

### 8. 后端集成

如果需要从后端发送推送，使用以下参数：

- **AppKey**: `463f52032571434a7a2ddeee`
- **MasterSecret**: `dae68cd8344bdd329d032915` (仅后端使用)
- **API地址**: `https://api.jpush.cn/v3/push`

## 测试完成标准

- ✅ 能获取RegistrationID
- ✅ 能接收推送通知
- ✅ 能正确处理通知点击
- ✅ 推送配置功能正常
- ✅ 日志输出正常

## 相关文档

- [极光推送REST API](https://docs.jiguang.cn/jpush/server/push/rest_api_v3_push/)
- [jpush-react-native文档](https://github.com/jpush/jpush-react-native)
- [问题反馈](https://community.jiguang.cn/)